<UserControl x:Class="HouseholdMS.View.Measurement.OscilloscopeView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:chart="http://schemas.syncfusion.com/wpf"
             xmlns:ctrls="clr-namespace:HouseholdMS.View.Measurement.Controls"
             mc:Ignorable="d"
             Background="#F6F7FB">

    <UserControl.Resources>
        <SolidColorBrush x:Key="Col.Page" Color="#F6F7FB"/>
        <SolidColorBrush x:Key="Col.Card" Color="#FFFFFFFF"/>
        <SolidColorBrush x:Key="Col.Border" Color="#E5E7EB"/>
        <SolidColorBrush x:Key="Col.Muted" Color="#6B7280"/>
        <Style x:Key="Card" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource Col.Card}"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="BorderBrush" Value="{StaticResource Col.Border}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12"/>
            <Setter Property="Margin" Value="8"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="6" ShadowDepth="0" Opacity="0.08"/>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Grid Background="{StaticResource Col.Page}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Top bar -->
        <Border Grid.Row="0" Style="{StaticResource Card}">
            <DockPanel>
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Left">
                    <TextBlock Text="VISA:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                    <TextBox x:Name="VisaAddressBox" Width="360" Text="USB0::0x0699::0x03C4::C044134::INSTR"/>
                    <Button Content="Connect" Margin="8,0,0,0" Click="Connect_Click"/>
                    <Button Content="Disconnect" Margin="8,0,0,0" Click="Disconnect_Click"/>
                    <Button Content="*IDN?" Margin="8,0,0,0" Click="ReadIDN_Click"/>
                </StackPanel>
                <TextBlock x:Name="StatusBlock" Foreground="{StaticResource Col.Muted}" VerticalAlignment="Center" Margin="16,0,0,0"/>
            </DockPanel>
        </Border>

        <!-- Body -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="370"/>
            </Grid.ColumnDefinitions>

            <!-- Chart -->
            <Border Grid.Column="0" Style="{StaticResource Card}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <TextBlock Text="Waveform" FontWeight="Bold" FontSize="16" Margin="0,0,0,8"/>
                    <chart:SfChart x:Name="ScopeChart" Grid.Row="1" Margin="0,4,0,0">
                        <chart:SfChart.PrimaryAxis>
                            <!-- Auto-range each refresh; clean labels -->
                            <chart:NumericalAxis Header="Time (s)" RangePadding="Round" LabelFormat="0.###E+0" ShowGridLines="True"/>
                        </chart:SfChart.PrimaryAxis>
                        <chart:SfChart.SecondaryAxis>
                            <chart:NumericalAxis Header="Voltage (V)" RangePadding="Round" LabelFormat="0.###" ShowGridLines="True"/>
                        </chart:SfChart.SecondaryAxis>
                        <chart:SfChart.Legend>
                            <chart:ChartLegend/>
                        </chart:SfChart.Legend>
                        <chart:SfChart.Behaviors>
                            <chart:ChartZoomPanBehavior EnableSelectionZooming="True" EnablePanning="True"/>
                            <chart:ChartTrackBallBehavior ShowLine="True"/>
                        </chart:SfChart.Behaviors>
                        <chart:FastLineBitmapSeries x:Name="SeriesCH1" Label="CH1" XBindingPath="X" YBindingPath="Y" StrokeThickness="1.2" Opacity="0.95"/>
                        <chart:FastLineBitmapSeries x:Name="SeriesCH2" Label="CH2" XBindingPath="X" YBindingPath="Y" StrokeThickness="1.2" Opacity="0.95"/>
                        <chart:FastLineBitmapSeries x:Name="SeriesMATH" Label="MATH(CH1-CH2)" XBindingPath="X" YBindingPath="Y" StrokeThickness="1.2" Opacity="0.95"/>
                    </chart:SfChart>
                </Grid>
            </Border>

            <!-- Tabs -->
            <Border Grid.Column="1" Style="{StaticResource Card}">
                <TabControl>
                    <TabItem Header="Acquisition">
                        <ctrls:AcquisitionTab x:Name="AcqTab"
                                  RunRequested="Acq_RunRequested"
                                  StopRequested="Acq_StopRequested"
                                  SingleRequested="Acq_SingleRequested"
                                  AutosetRequested="Acq_AutosetRequested"
                                  SetTimebaseRequested="Acq_SetTimebaseRequested"
                                  ReadRecordLengthRequested="Acq_ReadRecordLengthRequested"/>
                    </TabItem>
                    <TabItem Header="Channels">
                        <ctrls:ChannelsTab x:Name="ChTab"
                               ApplyCh1Requested="Ch_ApplyCh1Requested"
                               ApplyCh2Requested="Ch_ApplyCh2Requested"
                               SetProbeRequested="Ch_SetProbeRequested"/>
                    </TabItem>
                    <TabItem Header="Measurements">
                        <ctrls:MeasurementsTab x:Name="MeasTab" PollIntervalChanged="Meas_PollIntervalChanged"/>
                    </TabItem>
                    <TabItem Header="Export">
                        <ctrls:ExportTab x:Name="ExpTab" SaveCsvRequested="Exp_SaveCsvRequested" SavePngRequested="Exp_SavePngRequested"/>
                    </TabItem>
                </TabControl>
            </Border>
        </Grid>

        <TextBlock Grid.Row="2" Margin="12,0,12,12" Foreground="{StaticResource Col.Muted}"
               Text="Tips: Run/Single/Autoset in Acquisition; tune Coupling/Scale in Channels; view metrics in Measurements; export in Export tab."/>
    </Grid>
</UserControl>
