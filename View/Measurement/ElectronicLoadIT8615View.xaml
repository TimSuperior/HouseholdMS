<UserControl x:Class="HouseholdMS.View.Measurement.ElectronicLoadIT8615View" 
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:chart="http://schemas.syncfusion.com/wpf"
             mc:Ignorable="d"
             Background="#F6F7FB">

    <UserControl.Resources>
        <SolidColorBrush x:Key="Col.Page" Color="#F6F7FB"/>
        <SolidColorBrush x:Key="Col.Card" Color="#FFFFFFFF"/>
        <SolidColorBrush x:Key="Col.Border" Color="#E5E7EB"/>
        <SolidColorBrush x:Key="Col.Muted" Color="#6B7280"/>

        <Style x:Key="Card" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource Col.Card}"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="BorderBrush" Value="{StaticResource Col.Border}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12"/>
            <Setter Property="Margin" Value="8"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="6" ShadowDepth="0" Opacity="0.08"/>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="TextBox">
            <Setter Property="Margin" Value="4,0,0,0"/>
            <Setter Property="MinWidth" Value="90"/>
        </Style>
        <Style TargetType="ComboBox">
            <Setter Property="Margin" Value="4,0,0,0"/>
        </Style>
        <Style TargetType="Button">
            <Setter Property="Margin" Value="8,0,0,0"/>
        </Style>
        <Style TargetType="CheckBox">
            <Setter Property="Margin" Value="8,0,0,0"/>
        </Style>
        <Style TargetType="Slider">
            <Setter Property="Margin" Value="6,0,0,0"/>
        </Style>
    </UserControl.Resources>

    <Grid Background="{StaticResource Col.Page}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Top bar -->
        <Border Grid.Row="0" Style="{StaticResource Card}">
            <DockPanel>
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Left">
                    <TextBlock Text="VISA:" VerticalAlignment="Center"/>
                    <TextBox x:Name="VisaAddressBox" Width="360" Text="USB0::0x2EC7::0x8600::INSTR"/>
                    <Button Content="Scan" Click="Scan_Click"/>
                    <ComboBox x:Name="VisaResultsBox" Width="380" Visibility="Collapsed"
                              SelectionChanged="VisaResultsBox_SelectionChanged"/>
                    <Button Content="Connect" Click="Connect_Click"/>
                    <Button Content="Disconnect" Click="Disconnect_Click"/>
                    <Button Content="*IDN?" Click="ReadIDN_Click"/>
                    <CheckBox x:Name="InputEnableBox" Content="INPUT ON"
                              Checked="InputEnableBox_Changed" Unchecked="InputEnableBox_Changed"/>
                </StackPanel>
                <TextBlock x:Name="StatusBlock" Foreground="{StaticResource Col.Muted}"
                           VerticalAlignment="Center" Margin="16,0,0,0"/>
            </DockPanel>
        </Border>

        <!-- Body -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="370"/>
            </Grid.ColumnDefinitions>

            <!-- Chart -->
            <Border Grid.Column="0" Style="{StaticResource Card}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Waveform (Voltage and Current)" FontWeight="Bold" FontSize="16" Margin="0,0,12,8"/>
                        <Button Content="Run" Click="Wave_Run_Click"/>
                        <Button Content="Stop" Click="Wave_Stop_Click"/>
                        <Button Content="Single" Click="Wave_Single_Click"/>
                        <Button Content="Export CSV" Click="ExportCsv_Click"/>
                    </StackPanel>

                    <chart:SfChart x:Name="WaveChart" Grid.Row="1">
                        <chart:SfChart.PrimaryAxis>
                            <chart:NumericalAxis Header="Time (s)" LabelFormat="0.###E+0" RangePadding="Round" ShowGridLines="True"/>
                        </chart:SfChart.PrimaryAxis>
                        <chart:SfChart.SecondaryAxis>
                            <chart:NumericalAxis Header="Value" LabelFormat="0.###" RangePadding="Round" ShowGridLines="True"/>
                        </chart:SfChart.SecondaryAxis>
                        <chart:SfChart.Legend>
                            <chart:ChartLegend/>
                        </chart:SfChart.Legend>
                        <chart:SfChart.Behaviors>
                            <chart:ChartZoomPanBehavior EnableSelectionZooming="True" EnablePanning="True"/>
                            <chart:ChartTrackBallBehavior ShowLine="True"/>
                        </chart:SfChart.Behaviors>
                        <chart:FastLineBitmapSeries x:Name="SeriesV" Label="Voltage (V)" XBindingPath="X" YBindingPath="Y" StrokeThickness="1.2" Opacity="0.95"/>
                        <chart:FastLineBitmapSeries x:Name="SeriesI" Label="Current (A)" XBindingPath="X" YBindingPath="Y" StrokeThickness="1.2" Opacity="0.95"/>
                    </chart:SfChart>

                    <!-- Measurements strip -->
                    <WrapPanel Grid.Row="2" Margin="0,8,0,0">
                        <TextBlock Text="Vrms:"/>
                        <TextBlock x:Name="VrmsText" Margin="4,0,12,0"/>
                        <TextBlock Text="Irms:"/>
                        <TextBlock x:Name="IrmsText" Margin="4,0,12,0"/>
                        <TextBlock Text="P:"/>
                        <TextBlock x:Name="PText" Margin="4,0,12,0"/>
                        <TextBlock Text="S:"/>
                        <TextBlock x:Name="SText" Margin="4,0,12,0"/>
                        <TextBlock Text="Q:"/>
                        <TextBlock x:Name="QText" Margin="4,0,12,0"/>
                        <TextBlock Text="PF:"/>
                        <TextBlock x:Name="PFText" Margin="4,0,12,0"/>
                        <TextBlock Text="Freq:"/>
                        <TextBlock x:Name="FreqText" Margin="4,0,12,0"/>
                        <TextBlock Text="THD:"/>
                        <TextBlock x:Name="THDText" Margin="4,0,12,0"/>
                    </WrapPanel>
                </Grid>
            </Border>

            <!-- Right Control Pane -->
            <Border Grid.Column="1" Style="{StaticResource Card}">
                <TabControl>
                    <TabItem Header="Mode">
                        <StackPanel>
                            <WrapPanel>
                                <TextBlock Text="Mode:" VerticalAlignment="Center"/>
                                <ComboBox x:Name="ModeBox" SelectedIndex="0" SelectionChanged="ModeBox_SelectionChanged">
                                    <ComboBoxItem Content="CC"/>
                                    <ComboBoxItem Content="CV"/>
                                    <ComboBoxItem Content="CR"/>
                                    <ComboBoxItem Content="CP"/>
                                    <ComboBoxItem Content="SHORT"/>
                                </ComboBox>
                            </WrapPanel>

                            <!-- CC -->
                            <StackPanel x:Name="CcPanel" Margin="0,6,0,0">
                                <WrapPanel>
                                    <TextBlock Text="Current (A):"/>
                                    <TextBox x:Name="CcSetBox" Text="5"/>
                                    <Button Content="Apply" Click="CcApply_Click"/>
                                </WrapPanel>
                                <WrapPanel>
                                    <TextBlock Text="OCP (A):"/>
                                    <TextBox x:Name="OcpLevelBox" Text="9999"/>
                                    <Button Content="Set OCP" Click="OcpApply_Click"/>
                                    <CheckBox x:Name="OcpEnableBox" Content="OCP ON" Checked="OcpEnableBox_Changed" Unchecked="OcpEnableBox_Changed"/>
                                </WrapPanel>
                            </StackPanel>

                            <!-- CV -->
                            <StackPanel x:Name="CvPanel" Margin="0,6,0,0" Visibility="Collapsed">
                                <WrapPanel>
                                    <TextBlock Text="Voltage (V):"/>
                                    <TextBox x:Name="CvSetBox" Text="230"/>
                                    <Button Content="Apply" Click="CvApply_Click"/>
                                </WrapPanel>
                                <WrapPanel ToolTip="IT8615/IT8615L only">
                                    <TextBlock Text="CV I-Limit (A):"/>
                                    <TextBox x:Name="CvILimitBox" Text="20"/>
                                    <Button Content="Set Limit" Click="CvILimitApply_Click"/>
                                </WrapPanel>
                            </StackPanel>

                            <!-- CR -->
                            <StackPanel x:Name="CrPanel" Margin="0,6,0,0" Visibility="Collapsed">
                                <WrapPanel>
                                    <TextBlock Text="Resistance (Ω):"/>
                                    <TextBox x:Name="CrSetBox" Text="10"/>
                                    <Button Content="Apply" Click="CrApply_Click"/>
                                </WrapPanel>
                            </StackPanel>

                            <!-- CP -->
                            <StackPanel x:Name="CpPanel" Margin="0,6,0,0" Visibility="Collapsed">
                                <WrapPanel>
                                    <TextBlock Text="Power (W):"/>
                                    <TextBox x:Name="CpSetBox" Text="1000"/>
                                    <Button Content="Apply" Click="CpApply_Click"/>
                                </WrapPanel>
                                <WrapPanel>
                                    <TextBlock Text="OPP (W):"/>
                                    <TextBox x:Name="OppLevelBox" Text="99999"/>
                                    <Button Content="Set OPP" Click="OppApply_Click"/>
                                    <CheckBox x:Name="OppEnableBox" Content="OPP ON" Checked="OppEnableBox_Changed" Unchecked="OppEnableBox_Changed"/>
                                </WrapPanel>
                            </StackPanel>

                            <!-- SHORT -->
                            <StackPanel x:Name="ShortPanel" Margin="0,6,0,0" Visibility="Collapsed">
                                <WrapPanel>
                                    <CheckBox x:Name="ShortEnableBox" Content="SHORT ON" Checked="ShortEnableBox_Changed" Unchecked="ShortEnableBox_Changed"/>
                                </WrapPanel>
                            </StackPanel>
                        </StackPanel>
                    </TabItem>

                    <TabItem Header="AC Params">
                        <StackPanel>
                            <WrapPanel>
                                <TextBlock Text="PF:"/>
                                <TextBox x:Name="PfBox" Text="1.0"/>
                                <Button Content="Apply" Click="PfApply_Click"/>
                            </WrapPanel>
                            <WrapPanel>
                                <TextBlock Text="CF:"/>
                                <TextBox x:Name="CfBox" Text="1.4"/>
                                <Button Content="Apply" Click="CfApply_Click"/>
                            </WrapPanel>
                            <WrapPanel>
                                <TextBlock Text="Rate (CC):"/>
                                <ComboBox x:Name="RateCcBox" SelectedIndex="0">
                                    <ComboBoxItem Content="SLOW"/>
                                    <ComboBoxItem Content="HIGH"/>
                                </ComboBox>
                                <Button Content="Set" Click="RateCcApply_Click"/>
                            </WrapPanel>
                            <WrapPanel>
                                <TextBlock Text="Rate (CV-DC):"/>
                                <ComboBox x:Name="RateCvDcBox" SelectedIndex="0">
                                    <ComboBoxItem Content="SLOW"/>
                                    <ComboBoxItem Content="HIGH"/>
                                </ComboBox>
                                <Button Content="Set" Click="RateCvDcApply_Click"/>
                            </WrapPanel>
                        </StackPanel>
                    </TabItem>

                    <TabItem Header="Wave/Trigger">
                        <StackPanel>
                            <WrapPanel>
                                <TextBlock Text="Trig Source:"/>
                                <ComboBox x:Name="TrigSourceBox" SelectedIndex="0">
                                    <ComboBoxItem Content="VOLTage"/>
                                    <ComboBoxItem Content="CURRent"/>
                                </ComboBox>
                                <Button Content="Apply" Click="TrigSourceApply_Click"/>
                            </WrapPanel>
                            <WrapPanel>
                                <TextBlock Text="Trig Mode:"/>
                                <ComboBox x:Name="TrigModeBox" SelectedIndex="0">
                                    <ComboBoxItem Content="AUTO"/>
                                    <ComboBoxItem Content="NORMal"/>
                                </ComboBox>
                                <Button Content="Apply" Click="TrigModeApply_Click"/>
                            </WrapPanel>
                            <WrapPanel>
                                <TextBlock Text="Slope:"/>
                                <ComboBox x:Name="TrigSlopeBox" SelectedIndex="0">
                                    <ComboBoxItem Content="POSitive"/>
                                    <ComboBoxItem Content="NEGative"/>
                                    <ComboBoxItem Content="ANY"/>
                                </ComboBox>
                                <Button Content="Apply" Click="TrigSlopeApply_Click"/>
                            </WrapPanel>
                            <WrapPanel>
                                <TextBlock Text="Level:"/>
                                <TextBox x:Name="TrigLevelBox" Text="0"/>
                                <Button Content="Apply" Click="TrigLevelApply_Click"/>
                            </WrapPanel>
                            <WrapPanel>
                                <TextBlock Text="Delay (s):"/>
                                <TextBox x:Name="TrigDelayBox" Text="0"/>
                                <Button Content="Apply" Click="TrigDelayApply_Click"/>
                            </WrapPanel>
                            <WrapPanel>
                                <TextBlock Text="Div Time (s/div):"/>
                                <ComboBox x:Name="DivTimeBox" SelectedIndex="3">
                                    <ComboBoxItem Content="0.0005"/>
                                    <ComboBoxItem Content="0.001"/>
                                    <ComboBoxItem Content="0.002"/>
                                    <ComboBoxItem Content="0.005"/>
                                    <ComboBoxItem Content="0.01"/>
                                    <ComboBoxItem Content="0.02"/>
                                    <ComboBoxItem Content="0.05"/>
                                    <ComboBoxItem Content="0.1"/>
                                    <ComboBoxItem Content="0.2"/>
                                </ComboBox>
                                <Button Content="Apply" Click="DivTimeApply_Click"/>
                            </WrapPanel>
                        </StackPanel>
                    </TabItem>
                </TabControl>
            </Border>
        </Grid>

        <TextBlock Grid.Row="2" Margin="12,0,12,12" Foreground="{StaticResource Col.Muted}"
                   Text="Tip: Click Scan to auto-fill the exact USB/ASRL resource (with serial). Then Connect and *IDN?."/>
    </Grid>
</UserControl>
