<UserControl x:Class="HouseholdMS.View.Measurement.Tbs1000cView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:syncfusion="http://schemas.syncfusion.com/wpf"
             MinWidth="1040" MinHeight="760"
             FontFamily="Segoe UI" FontSize="13"
             SnapsToDevicePixels="True" UseLayoutRounding="True">
    <Grid Background="#F7F9FC">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="200"/>
        </Grid.RowDefinitions>

        <!-- Header / Connection -->
        <DockPanel Grid.Row="0" Margin="12,12,12,6">
            <TextBlock Text="Tektronix TBS1202C — Remote Control"
                 FontSize="18" FontWeight="SemiBold" />
            <StackPanel Orientation="Horizontal" DockPanel.Dock="Right">
                <Button Content="Connect" Click="Connect_Click" Margin="6,0,0,0"/>
                <Button Content="Disconnect" Click="Disconnect_Click" Margin="6,0,0,0"/>
                <Separator Width="10"/>
                <Button Content="*IDN?" Click="BtnIdn_Click" Margin="6,0,0,0"/>
                <Button Content="*RST" Click="BtnRst_Click" Margin="6,0,0,0"/>
                <Button Content="*CLS" Click="BtnCls_Click" Margin="6,0,0,0"/>
                <Separator Width="10"/>
                <Button Content="AUTOSet" ToolTip="AUTOSet EXECute" Click="BtnAutoset_Click" Margin="6,0,0,0"/>
            </StackPanel>
        </DockPanel>

        <!-- Main Area: Graph first (with left control panel), Measurements as second tab -->
        <TabControl Grid.Row="1" Margin="12,6,12,12">
            <!-- GRAPH TAB (main) -->
            <TabItem Header="Graph">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="360"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Top toolbar (source selection + actions) -->
                    <DockPanel Grid.Row="0" Grid.ColumnSpan="2" Margin="0,0,0,10">
                        <StackPanel Orientation="Horizontal" DockPanel.Dock="Left" VerticalAlignment="Center">
                            <TextBlock Text="Sources:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                            <CheckBox x:Name="SrcCh1" Content="CH1" IsChecked="True" Margin="0,0,6,0"/>
                            <CheckBox x:Name="SrcCh2" Content="CH2" IsChecked="False" Margin="0,0,12,0"/>
                            <TextBlock Text="Live (Hz):" VerticalAlignment="Center" Margin="0,0,6,0"/>
                            <TextBox x:Name="LiveHz" Width="56" Text="5" Margin="0,0,12,0" ToolTip="Polling rate for CURVe? reads"/>
                            <Button Content="Fit All" Click="BtnFitAll_Click" Margin="0,0,6,0"/>
                            <Button Content="Clear" Click="BtnClearCharts_Click" Margin="0,0,6,0"/>
                            <Button x:Name="BtnPauseLive" Content="Pause Live" Click="BtnPauseLive_Click" Margin="6,0,0,0"/>
                        </StackPanel>

                        <!-- Axis-range controls -->
                        <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" VerticalAlignment="Center">
                            <TextBlock Text="X:" VerticalAlignment="Center" Margin="6,0,4,0"/>
                            <CheckBox x:Name="XAuto" Content="Auto" IsChecked="True" Margin="0,0,6,0"/>
                            <TextBox x:Name="XMin" Width="80" Margin="0,0,4,0" ToolTip="X Min (s)"/>
                            <TextBox x:Name="XMax" Width="80" Margin="0,0,8,0" ToolTip="X Max (s)"/>

                            <TextBlock Text="Y:" VerticalAlignment="Center" Margin="6,0,4,0"/>
                            <CheckBox x:Name="YAuto" Content="Auto" IsChecked="True" Margin="0,0,6,0"/>
                            <TextBox x:Name="YMin" Width="80" Margin="0,0,4,0" ToolTip="Y Min"/>
                            <TextBox x:Name="YMax" Width="80" Margin="0,0,6,0" ToolTip="Y Max"/>
                            <Button Content="Apply Range" Click="BtnApplyAxis_Click" Margin="0,0,6,0"/>
                            <Button Content="Auto from Data" Click="BtnAutoAxisFromData_Click"/>
                        </StackPanel>
                    </DockPanel>

                    <!-- LEFT PANEL: Expanders with graph-affecting settings -->
                    <ScrollViewer Grid.Row="1" Grid.Column="0" VerticalScrollBarVisibility="Auto" Margin="0,0,10,0">
                        <StackPanel>

                            <!-- Acquisition -->
                            <Expander Header="Acquisition" IsExpanded="True" Margin="0,0,0,8">
                                <StackPanel Margin="8">
                                    <WrapPanel>
                                        <Button Content="RUN" Click="BtnRun_Click" Margin="0,0,6,0"/>
                                        <Button Content="STOP" Click="BtnStop_Click" Margin="0,0,6,0"/>
                                        <Button Content="SINGLE" Click="BtnSingle_Click" Margin="0,0,6,0"/>
                                    </WrapPanel>
                                    <WrapPanel Margin="0,6,0,0">
                                        <TextBlock Text="Mode:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                        <ComboBox x:Name="AcqMode2" Width="140" SelectedIndex="0">
                                            <ComboBoxItem Content="SAMPLE"/>
                                            <ComboBoxItem Content="PEAK"/>
                                            <ComboBoxItem Content="HIRES"/>
                                            <ComboBoxItem Content="AVER"/>
                                        </ComboBox>
                                        <TextBlock Text="NumAvg:" VerticalAlignment="Center" Margin="8,0,6,0"/>
                                        <TextBox x:Name="AcqNumAvg2" Width="70" Text="16"/>
                                        <Button Content="Apply" Click="BtnAcqApply2_Click" Margin="8,0,0,0"/>
                                    </WrapPanel>
                                </StackPanel>
                            </Expander>

                            <!-- Timebase -->
                            <Expander Header="Timebase" IsExpanded="True" Margin="0,0,0,8">
                                <StackPanel>
                                    <WrapPanel Margin="8,8,8,0">
                                        <TextBlock Text="Scale (s/div)" Margin="0,0,6,0"/>
                                        <TextBox x:Name="TbScale2" Width="90" Text="0.001" Margin="0,0,6,0"/>
                                        <TextBlock Text="Pos (s)" Margin="0,0,6,0"/>
                                        <TextBox x:Name="TbPos2" Width="90" Text="0" Margin="0,0,6,0"/>
                                        <Button Content="Apply" Click="BtnTbApply2_Click" Margin="6,0,0,0"/>
                                    </WrapPanel>
                                    <WrapPanel Margin="8,6,8,8">
                                        <TextBlock Text="Record Len" Margin="0,0,6,0"/>
                                        <TextBox x:Name="TbRecord" Width="90" Text="2000" Margin="0,0,6,0"/>
                                        <Button Content="Set" Click="BtnTbRecord_Click" Margin="0,0,6,0"/>
                                        <CheckBox x:Name="TbRoll" Content="Roll Mode" Margin="0,0,6,0"/>
                                        <Button Content="Apply" Click="BtnTbRoll_Click" Margin="0,0,6,0"/>
                                        <Button Content="Sample Rate?" Click="BtnTbSrq_Click"/>
                                    </WrapPanel>
                                </StackPanel>
                            </Expander>

                            <!-- Channel (applies to checked sources) -->
                            <Expander Header="Channel" IsExpanded="True" Margin="0,0,0,8">
                                <StackPanel Margin="8">
                                    <TextBlock Text="Applies to all checked sources above (CH1/CH2)." Margin="0,0,0,6" Foreground="#555"/>
                                    <WrapPanel>
                                        <TextBlock Text="Scale (V/div)" Margin="0,0,6,0"/>
                                        <TextBox x:Name="ChScaleG" Width="80" Text="1" Margin="0,0,6,0"/>
                                        <TextBlock Text="Offset (V)" Margin="0,0,6,0"/>
                                        <TextBox x:Name="ChOffsetG" Width="80" Text="0" Margin="0,0,6,0"/>
                                    </WrapPanel>
                                    <WrapPanel Margin="0,6,0,0">
                                        <TextBlock Text="Coupling" Margin="0,0,6,0"/>
                                        <ComboBox x:Name="ChCouplingG" Width="100" SelectedIndex="0">
                                            <ComboBoxItem Content="DC"/>
                                            <ComboBoxItem Content="AC"/>
                                            <ComboBoxItem Content="GND"/>
                                        </ComboBox>
                                        <CheckBox x:Name="ChBWLimitG" Content="20 MHz BW Limit" Margin="8,0,6,0"/>
                                        <CheckBox x:Name="ChInvertG" Content="Invert" Margin="0,0,6,0"/>
                                    </WrapPanel>
                                    <WrapPanel Margin="0,6,0,0">
                                        <Button Content="Apply" Click="BtnChApplyFromChart_Click"/>
                                    </WrapPanel>
                                </StackPanel>
                            </Expander>

                            <!-- Trigger -->
                            <Expander Header="Trigger" IsExpanded="False" Margin="0,0,0,8">
                                <StackPanel Margin="8">
                                    <WrapPanel>
                                        <TextBlock Text="Source" Margin="0,0,6,0"/>
                                        <ComboBox x:Name="TrigSource" Width="100" Margin="0,0,6,0" SelectedIndex="0">
                                            <ComboBoxItem Content="CH1"/>
                                            <ComboBoxItem Content="CH2"/>
                                        </ComboBox>
                                        <TextBlock Text="Slope" Margin="0,0,6,0"/>
                                        <ComboBox x:Name="TrigSlope" Width="100" Margin="0,0,6,0" SelectedIndex="0">
                                            <ComboBoxItem Content="RISe"/>
                                            <ComboBoxItem Content="FALL"/>
                                        </ComboBox>
                                    </WrapPanel>
                                    <WrapPanel Margin="0,6,0,0">
                                        <TextBlock Text="Coupling" Margin="0,0,6,0"/>
                                        <ComboBox x:Name="TrigCoupling" Width="100" Margin="0,0,6,0" SelectedIndex="0">
                                            <ComboBoxItem Content="DC"/>
                                            <ComboBoxItem Content="AC"/>
                                            <ComboBoxItem Content="HFREJ"/>
                                            <ComboBoxItem Content="LFREJ"/>
                                        </ComboBox>
                                        <Button Content="Apply" Click="BtnTrigApply_Click" Margin="8,0,0,0"/>
                                    </WrapPanel>
                                    <WrapPanel Margin="0,6,0,0">
                                        <TextBlock Text="Level (V)" Margin="0,0,6,0"/>
                                        <TextBox x:Name="TrigLevel" Width="90" Text="0.2" Margin="0,0,6,0"/>
                                        <Button Content="Set Level" Click="BtnTrigLevel_Click" Margin="0,0,6,0"/>
                                        <TextBlock Text="Holdoff (s)" Margin="0,0,6,0"/>
                                        <TextBox x:Name="TrigHoldoff" Width="90" Text="0" Margin="0,0,6,0"/>
                                        <Button Content="Set Holdoff" Click="BtnTrigHoldoff_Click" Margin="0,0,6,0"/>
                                        <Button Content="State?" Click="BtnTrigState_Click"/>
                                    </WrapPanel>
                                </StackPanel>
                            </Expander>

                            <!-- Cursors -->
                            <Expander Header="Cursors" IsExpanded="False" Margin="0,0,0,8">
                                <StackPanel Margin="8">
                                    <CheckBox x:Name="CurEnable" Content="Enable Cursors" Margin="0,0,0,6"
                            Checked="CurEnable_CheckedChanged" Unchecked="CurEnable_CheckedChanged"/>
                                    <WrapPanel Margin="0,0,0,6">
                                        <TextBlock Text="Function" Margin="0,0,6,0"/>
                                        <ComboBox x:Name="CurFunc" Width="120" Margin="0,0,6,0" SelectedIndex="1">
                                            <ComboBoxItem Content="HBARs"/>
                                            <ComboBoxItem Content="VBARs"/>
                                            <ComboBoxItem Content="TRACK"/>
                                        </ComboBox>
                                        <Button Content="Apply" Click="BtnCurApply_Click"/>
                                    </WrapPanel>
                                    <WrapPanel Margin="0,0,0,6">
                                        <TextBlock Text="H1 (s)" Margin="0,0,6,0"/>
                                        <TextBox x:Name="CurH1" Width="80" Text="0" Margin="0,0,6,0"/>
                                        <TextBlock Text="H2 (s)" Margin="0,0,6,0"/>
                                        <TextBox x:Name="CurH2" Width="80" Text="0.001" Margin="0,0,6,0"/>
                                        <Button Content="Set H" Click="BtnCurSetH_Click" Margin="0,0,6,0"/>
                                        <Button Content="Δt?" Click="BtnCurDeltaH_Click"/>
                                    </WrapPanel>
                                    <WrapPanel>
                                        <TextBlock Text="V1 (V)" Margin="0,0,6,0"/>
                                        <TextBox x:Name="CurV1" Width="80" Text="0" Margin="0,0,6,0"/>
                                        <TextBlock Text="V2 (V)" Margin="0,0,6,0"/>
                                        <TextBox x:Name="CurV2" Width="80" Text="1" Margin="0,0,6,0"/>
                                        <Button Content="Set V" Click="BtnCurSetV_Click" Margin="0,0,6,0"/>
                                        <Button Content="ΔV?" Click="BtnCurDeltaV_Click"/>
                                    </WrapPanel>
                                </StackPanel>
                            </Expander>

                            <!-- Display -->
                            <Expander Header="Display" IsExpanded="False" Margin="0,0,0,8">
                                <StackPanel Margin="8">
                                    <WrapPanel>
                                        <CheckBox x:Name="DispPersistOn" Content="Persistence On" Margin="0,0,6,0"/>
                                        <TextBlock Text="Persistence (s)" Margin="6,0,6,0"/>
                                        <TextBox x:Name="DispPersistSec" Width="80" Text="3"/>
                                        <Button Content="Apply" Click="BtnDispApply_Click" Margin="6,0,0,0"/>
                                    </WrapPanel>
                                </StackPanel>
                            </Expander>

                        </StackPanel>
                    </ScrollViewer>

                    <!-- CHART -->
                    <GroupBox Grid.Row="1" Grid.Column="1" Header="Time Domain">
                        <Grid>
                            <syncfusion:SfChart x:Name="TimeChart" Background="White" BorderBrush="#DDD" BorderThickness="1">
                                <syncfusion:SfChart.PrimaryAxis>
                                    <syncfusion:NumericalAxis x:Name="AxisTimeX" Header="Time (s)" RangePadding="None"/>
                                </syncfusion:SfChart.PrimaryAxis>
                                <syncfusion:SfChart.SecondaryAxis>
                                    <syncfusion:NumericalAxis x:Name="AxisTimeY" Header="Voltage (V)" RangePadding="None"/>
                                </syncfusion:SfChart.SecondaryAxis>
                                <syncfusion:SfChart.Behaviors>
                                    <syncfusion:ChartZoomPanBehavior EnableSelectionZooming="True" ZoomMode="XY"/>
                                    <syncfusion:ChartTrackBallBehavior/>
                                </syncfusion:SfChart.Behaviors>
                            </syncfusion:SfChart>
                        </Grid>
                    </GroupBox>
                </Grid>
            </TabItem>

            <!-- MEASUREMENTS TAB -->
            <TabItem Header="Measurements">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="10">

                        <!-- existing measurement controls -->
                        <WrapPanel>
                            <TextBlock Text="Immediate Type" Margin="0,0,6,0"/>
                            <ComboBox x:Name="MeasType" Width="210" Margin="0,0,6,0" SelectedIndex="0">
                                <ComboBoxItem Content="FREQuency"/>
                                <ComboBoxItem Content="PERIod"/>
                                <ComboBoxItem Content="MEAN"/>
                                <ComboBoxItem Content="PK2Pk"/>
                                <ComboBoxItem Content="RMS"/>
                                <ComboBoxItem Content="RISe"/>
                                <ComboBoxItem Content="FALL"/>
                                <ComboBoxItem Content="MAXimum"/>
                                <ComboBoxItem Content="MINImum"/>
                                <ComboBoxItem Content="PDUty"/>
                                <ComboBoxItem Content="NDUty"/>
                                <ComboBoxItem Content="HIGH"/>
                                <ComboBoxItem Content="LOW"/>
                                <ComboBoxItem Content="AMPlitude"/>
                            </ComboBox>
                            <TextBlock Text="Source1" Margin="0,0,6,0"/>
                            <ComboBox x:Name="MeasSrc1" Width="90" Margin="0,0,6,0" SelectedIndex="0">
                                <ComboBoxItem Content="CH1"/>
                                <ComboBoxItem Content="CH2"/>
                            </ComboBox>
                            <TextBlock Text="Source2" Margin="0,0,6,0"/>
                            <ComboBox x:Name="MeasSrc2" Width="90" Margin="0,0,6,0" SelectedIndex="0">
                                <ComboBoxItem Content=""/>
                                <ComboBoxItem Content="CH1"/>
                                <ComboBoxItem Content="CH2"/>
                            </ComboBox>
                            <Button Content="Apply" Click="BtnMeasApply_Click" Margin="0,0,6,0"/>
                            <Button Content="Value?" Click="BtnMeasRead_Click"/>
                        </WrapPanel>

                        <WrapPanel Margin="0,8,0,6">
                            <Button Content="Discover Supported (src1)" Click="BtnMeasDiscover_Click" Margin="0,0,6,0"/>
                            <Button Content="Read Selected" Click="BtnMeasReadSelected_Click" Margin="0,0,6,0"/>
                            <TextBlock Text="(multi-select below)" VerticalAlignment="Center"/>
                        </WrapPanel>

                        <ListBox x:Name="MeasTypeList" SelectionMode="Extended" Height="160" />

                        <GroupBox Header="On-screen slots (show on scope)">
                            <WrapPanel Margin="8">
                                <TextBlock Text="Slot (1..6)" Margin="0,0,6,0"/>
                                <TextBox x:Name="MeasSlot" Width="60" Text="1" Margin="0,0,6,0"/>
                                <TextBlock Text="Type" Margin="0,0,6,0"/>
                                <TextBox x:Name="MeasSlotType" Width="160" Text="FREQuency" Margin="0,0,6,0"/>
                                <TextBlock Text="Src1" Margin="0,0,6,0"/>
                                <TextBox x:Name="MeasSlotS1" Width="80" Text="CH1" Margin="0,0,6,0"/>
                                <TextBlock Text="Src2" Margin="0,0,6,0"/>
                                <TextBox x:Name="MeasSlotS2" Width="80" Margin="0,0,6,0" ToolTip="use for phase/delay"/>
                                <Button Content="Configure Slot" Click="BtnMeasSlotCfg_Click" Margin="0,0,6,0"/>
                                <Button Content="Enable Slot" Click="BtnMeasSlotOn_Click" Margin="0,0,6,0"/>
                                <Button Content="Disable Slot" Click="BtnMeasSlotOff_Click" Margin="0,0,6,0"/>
                                <Button Content="Read Slot" Click="BtnMeasSlotRead_Click"/>
                            </WrapPanel>
                        </GroupBox>

                        <WrapPanel Margin="8,8,0,0">
                            <CheckBox x:Name="MeasGateCursor" Content="Gate by Cursors" Margin="0,0,6,0"/>
                            <Button Content="Apply Gate" Click="BtnMeasGate_Click"/>
                            <Button Content="Clear All Slots" Margin="8,0,0,0" Click="BtnMeasClearAllSlots_Click"/>
                        </WrapPanel>

                        <!-- NEW: Live Mini Graphs -->
                        <GroupBox Header="Live Mini Graphs (per-channel)" Margin="0,12,0,0">
                            <StackPanel>
                                <TextBlock Margin="8,4,8,8"
                                           Text="Updates ~every 2s while Live is running. Toggle CH1/CH2 in the Graph toolbar." 
                                           Foreground="#666"/>
                                <TextBlock Text="CH1" FontWeight="SemiBold" Margin="8,0,0,4"/>
                                <WrapPanel x:Name="MiniWrapCh1" Margin="6,0,6,6"/>
                                <Separator/>
                                <TextBlock Text="CH2" FontWeight="SemiBold" Margin="8,8,0,4"/>
                                <WrapPanel x:Name="MiniWrapCh2" Margin="6,0,6,6"/>
                            </StackPanel>
                        </GroupBox>

                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>

        <!-- Console / Output -->
        <TextBox x:Name="ConsoleOut" Grid.Row="2" Margin="12,0,12,12"
             FontFamily="Consolas" FontSize="12"
             TextWrapping="NoWrap" AcceptsReturn="True"
             VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto"
             IsReadOnly="True"/>
    </Grid>
</UserControl>
